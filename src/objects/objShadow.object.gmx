<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-10</depth>
  <persistent>0</persistent>
  <parentName>objSonicModified</parentName>
  <maskName>MaskMain</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/* Declarate Player Variables for later use */

    /* Motion values
         hsp;
         hspm;                  
         hspl;                  

         acc;                   
         dcc;

         vsp; 
         vspl;
         vfr;
   
         jmp;
    
    // Control iables
         angle;
         ground;
         layer;
         xdir;    

         action;
    
    // Animation iables
         animation;
         animations_old;
         animations_frame;
         animations_framemin;
         animations_framemax;
         animations_speed;
         animations_timer;
         animations_angle;
         animations_return;
    
    // Calculation values
         cosine;
         sine;
     cs;
     sn;*/
    
    // Input variables
         KEY_LEFT = keyboard_check (vk_left) or (gamepad_axis_value (0, gp_axislh) &lt; -0.6);
         KEY_RIGHT = keyboard_check (vk_right) or (gamepad_axis_value (0, gp_axislh) &gt; 0.6);
         KEY_UP = keyboard_check (vk_up);
         KEY_DOWN = keyboard_check (vk_down) or (gamepad_axis_value (0, gp_axislv) &gt; 0.6);
         KEY_A=ord("Z");
         KEY_B=ord("X");
         KEY_BH=keyboard_check (ord("X"));
         KEY_C = ord("C");
    
    /*==============================================================================//
                        Setup settings for Sonic
//==============================================================================*/

    hsp                 = 0;                     /* Horizontal Speed */
    hspm                = 11;                    /* Max Horizontal Speed */
    hspl                = 17;
    
    effect_clear();
    
    instance_create (x, y, objCamera);
    
    global.shieldhits = 0;
    
    if room != rmZ1_B
    {
       hsp = 0;
       hspm = 13;
    }  
    else
    {
        hsp = 8;
        hspm = 8;
    }                                                                            /* Horizontal Speed Limit */

    acc                 = 0.08;                  /* Acceleration */
    dcc                 = 0.1;                  /* Deacceleration */

    vsp                 = 0;                     /* Vertical Speed */
    vspl                = 13;                    /* Vertical Speed Limit */                /* Vertical Force */
    vfr = 0.3;
   
    jmp                 = -8;                    /* Jump strengtH */
    
    atk                 = 0;                     /* Check if Sonic is using an attack */
    
    lock                = 0;                     /* Check if Sonic is lock on to an enemy */
    
    spin                = 0;                     /* Check if Sonic is using spindash */
    
    delay               = 0;                     /* Set key delay */
    
    ready               = 0;                     /* Player time after injury */
    blink               = 0;                     /* Blink after injury */
    
    enable              = 1;                     /* Enable/Disable the keyboard */
    
    mach                = false;                 /* Check if Sonic is in boost mode */
    
    dead                = 0;                     /* Detect if dead */
    machTimer           = 15000;
    
    vfrw = 0.15;
    hspmw = 4;

//==============================================================================    
    angle               = 0;                     /* Angle */
    ground              = 1;                     /* Check if the player is on the ground */
    action              = 0;                     /* Action */
    layer               = 0;                     /* Actual Layer */
    skid_decc           = 0.17;
    
    xdir                = 1;                     /* Direction */
    
//==============================================================================
    animations_angle = 0;
    animations_old      = -1;
    animations_frame    = 0;
    animations_framemin = 0;
    animations_framemax = 0;
    animations_speed    = 0;
    animations_timer    = 0;
    animations_return   = 0;
    
    animationDash = 13;
    animationTrick = 17;
    
    tube_action = 22;
    
    
    global.shield = 0; //0 = none, 1 = normal, 2 = magnetic, 3 = red
    global.invincible = 0;
    global.superstate = 0;
    
//==============================================================================
    cosine                = 1;
    sine                = 0;
    
//===============================================================================
    rebounce_action     = 7; //Use this on enemy to tell Sonic to bounce up after using homing atk 
                             //(number must be the same as the action in draw event)
    ldash               = 0; //Tell when light dash is activated
    
    drown               = 1000;
    
    imageTimer          = 5;
    
    hurtvoice = sndShadowHurt;
    
    tube                = false;
    global.face = xdir;
    deathobj = objShadowHitDie;
    airSpecial = 14;
    groundSpecial = 15;
    
    spriteset = sprShadowActions;
    
    chaos_energy = 100; //Shadow's chaos meter; this limits Shadow's chaos abilities, set to halfway by default
    
    chaos_spear = 33; //Amount required for chaos spear
    chaos_spear_charged = 40; //Amount required for a charged chaos spear
    spear_charge = 90; //How long till we can shoot a charged chaos spear
    chaos_control = 50; //Amount required for chaos control (must be purchased first)
    chaos_blast = 100; //Amount required for chaos blast (must be purchased first)
    
    powersneakers = false;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="5">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if room == rmMainTownShop
    room_goto (rmShop);
if room == rmKnuxHub1
    room_goto (rmShopKnux);
if room == rmAmyHub1
    room_goto (rmShopAmy);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.invincible = false;
if audio_is_playing (bgmInvincible) audio_stop_sound(bgmInvincible);
/*if room = rmZ1_1rm1 or room = rmZ1_1rm2
    audio_play_sound (bgmEmeraldGarden, 10, true);
if room = rmZ2_1rm1M
    audio_play_sound (bgmLavaFilter, 10, true);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="1">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>powersneakers = false;
if audio_is_playing (bgmSpeedup) audio_stop_sound(bgmSpeedup);
/*if room = rmZ1_1rm1 or room = rmZ1_1rm2
    audio_play_sound (bgmEmeraldGarden, 10, true);
if room = rmZ2_1rm1M
    audio_play_sound (bgmLavaFilter, 10, true);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//Nothing
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if room != rmZ1_B
{
    instance_deactivate_region (view_xview[0]-32, view_yview[0]-32, view_wview[0]+64, view_hview[0]+64, false, true);
    instance_activate_region (view_xview[0]-16, view_yview[0]-16, view_wview[0]+32, view_hview[0]+32, true);
}

instance_activate_object (objGamepad);
instance_activate_object (objCamera);
instance_activate_object (objButton);
instance_activate_object (objButton2);
instance_activate_object (objWaterSurface);
instance_activate_object (objWhiteBlast);
instance_activate_object (prtMoving);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.face = xdir;
global.energy = chaos_energy;

if x &lt; hspm
   x = hspm;
else if x &gt; room_width-hspm
     x = room_width-hspm;
if y &lt; 5
   y = 5;
      //Activate this script if alive
   if dead=0
   {

   //Extra limit checks
   //if action == 14 vspl = 20; else vspl = 13;
   //if action == 15 dcc = 0.2; else dcc = 0.1;
   
   if mach == false hspl = 17; else hspl = 38;
   if mach == false hspm = 11; else hspm = 26;
   
   // Limit the values of the movement
   if (hsp&gt;hspl)     hsp = hspl;
   if (hsp&lt;-hspl)    hsp = -hspl;
   if (vsp&gt;vspl)     vsp = vspl;

   //================================================================= 
   //Horizontal Movement.
   if (hsp&gt;0) {         // If player is going to the right
      repeat (hsp) {    // move "horizontal speed" times
                        // while the sensor is not colliding.
                        
          if (scrCollideSensorRight(obstacle_layer | high_layer | low_layer,MaskLarge)) break;

          x+=cosine;
          y-=sine;
      }
   } else if (hsp&lt;0) {  // Same goes for while the player is going to the left
      repeat (-hsp) {
          if (scrCollideSensorLeft(obstacle_layer | high_layer | low_layer,MaskLarge)) break;
      
          x-=cosine;
          y+=sine;
      }
   }

   //=================================================================   
   //Vertical Movement. It does the same as the horizontal movement but on the vertical axis.
   if (vsp&gt;0) {
      repeat (vsp) {
          if (scrCollideSensorBottom(obstacle_layer | high_layer | low_layer,MaskLarge)) break;  
          y+=1;
      }
   } else if (vsp&lt;0) {
      repeat (-vsp) {
          if (scrCollideSensorTop(obstacle_layer | high_layer | low_layer,MaskLarge)) break;  
          y-=1;
      }
      if (scrCollideSensorTop(obstacle_layer | high_layer | low_layer,MaskLarge)) vsp=0;
   }

   //=================================================================      
   // Landing. If we are falling and we landed, if the delimiter lines are colliding, search for new angle.
   if (vsp&gt;=0 &amp;&amp;
      !ground &amp;&amp;
      scrCollideSensorBottom(obstacle_layer | high_layer | low_layer,MaskLarge) &amp;&amp;
      scrCollideSensorRight_line(obstacle_layer | high_layer | low_layer) &amp;&amp;
      scrCollideSensorLeft_line(obstacle_layer | high_layer | low_layer))
   {
         angle=calculate_angle(0,8,obstacle_layer | high_layer | low_layer);
         cosine=cos(degtorad(angle));
         sine=sin(degtorad(angle));

         hsp-=sine*vsp;
         vsp=0;
         ground=1;
         //audio_play_sound (sndLand, 10, false);

         if (action==1) action=0;       // If we were jumping, set to normal again
   }

   //=================================================================
   // Wall Collisions, if the side masks are colliding, move the player in order to avoid getting stuck.
   while(scrCollideSensorRight(obstacle_layer | high_layer | low_layer,MaskLarge))
   {
      x-=cosine;
      y+=sine;                                                                                        
   }

   while(scrCollideSensorLeft(obstacle_layer | high_layer | low_layer,MaskLarge))
   {
      x+=cosine;
      y-=sine;                                                                                        
   }

   //=================================================================   
   // Do slopes while we're on the ground.
   if (ground) {
      // Slopes up: If the main sensor is colliding with the background, push to up
      while (scrCollideSensorMain(obstacle_layer | high_layer | low_layer)) {
          x-=sine;
          y-=cosine;  
      }

      // Slopes down: If the main sensor isn't colliding with the background but the slope sensor does, push to down.
      while (!scrCollideSensorMain(obstacle_layer | high_layer | low_layer) &amp;&amp; scrCollideSensorSlopes(obstacle_layer | high_layer | low_layer,MaskMedium)) {
          x+=sine;
          y+=cosine;  
      }
   }

   //=================================================================     
   // Now, check if the delimeter lines aren't colliding while we are on the ground.
   // If that's true, get impulsed to the air
   if (ground)
   {
        if (!scrCollideSensorLeft_line(obstacle_layer | high_layer | low_layer) || !scrCollideSensorRight_line(obstacle_layer | high_layer | low_layer))
        {
            angle=0;
            vsp=-sine*hsp;
            hsp=cosine*hsp;
            ground=0;   
            cs=1;
            sn=0;
        }
       // Or if the player is too slow and we're on the roof or on a wall, fall
       if (angle&gt;55 &amp;&amp; angle&lt;305 &amp;&amp; abs(hsp)&lt;5.5)
       {
          angle=0;
          vsp=-sine*hsp;
          hsp=cosine*hsp;
          ground=0;
          cs=1;
          sn=0;
        }        
   }

   //=================================================================   
   // After moving, get the new angle of the ground while the delimeter lines are colliding
   // and the player is on the ground.
   if (ground &amp;&amp; scrCollideSensorLeft_line(obstacle_layer | high_layer | low_layer) &amp;&amp; scrCollideSensorRight_line(obstacle_layer | high_layer | low_layer)) {
      angle=calculate_angle(angle,8,obstacle_layer | high_layer | low_layer);
      cosine=cos(degtorad(angle));
      sine=sin(degtorad(angle));
   } else {
      angle=0;
      cosine=1;
      sine=0;
   }
   
   //=================================================================   
   // Return the mask to the normal one
   sprite_index=MaskMain;
   mask_index=MaskMain;
   
   }//End of dead script
     
       
   // First, we query the keyboard and store the key data into the variables, for latter use.
   if enable=1
   {
   KEY_LEFT = keyboard_check (vk_left) or (gamepad_axis_value (0, gp_axislh) &lt; -0.6);
   KEY_RIGHT = keyboard_check (vk_right) or (gamepad_axis_value (0, gp_axislh) &gt; 0.6);
   KEY_UP       = keyboard_check(vk_up) or (gamepad_axis_value (0, gp_axislv) &lt; -0.6);
   KEY_DOWN     = keyboard_check(vk_down) or (gamepad_axis_value (0, gp_axislv) &gt; 0.6);
   KEY_A        = keyboard_check_pressed(ord('Z')); //This has been changed to fit certain actions
   KEY_B        = keyboard_check_pressed(ord('X'));
   KEY_BH       = keyboard_check (ord("X")); //The attack button held down
   KEY_C        = keyboard_check_pressed (ord("C")); //The special move button
   }
   else
   {
   KEY_LEFT     = 0 //Keyboard is disabled
   KEY_RIGHT    = 0
   KEY_UP       = 0
   KEY_DOWN     = 0
   KEY_A        = 0
   KEY_B        = 0
   KEY_BH       = 0
   KEY_C        = 0
   }
   //Setup shortcut varibles
   enemy=instance_nearest(x,y,objHomingParent)
   nring=instance_nearest(x,y,objRing)

   // If the player pressed any direction, change
   if (KEY_LEFT)
   {
        xdir=-1;
   }
   if (KEY_RIGHT)
   {
        xdir=1;   
   }
   
   //Depth control
   if dead=0
   {if action != 16 depth=layer else depth = -10001}
   
   //View control. This view will follow player until player dies


   // After checking if the player is on the ground, we apply the deacceleration based on the actual angle.  
   if (ground)
   {
        hsp-=sine*(dcc*2.1);
   }
   
   // Accelerate or deaccelerate if the player pressed the keys
   if (KEY_LEFT)
   {
     if (hsp&gt;=0) hsp-=acc*4;                // If the player pressed the left key and the player was moving to the right, deaccelerate faster
     if (hsp&lt;0 &amp;&amp; hsp&gt;-hspm) hsp-=acc;      // otherwise, do normal acceleration
   }
   else if (KEY_RIGHT)                      
   {
     if (hsp&lt;=0) hsp+=acc*4;                // Same for the right, deaccelerate faster
     if (hsp&gt;0 &amp;&amp; hsp&lt;hspm) hsp+=acc;       // or do normal acceleration
   }
   else                                     // If any of these two keys hasn't been pressed, deaccelerate
   {
     if (hsp&gt;0) hsp-=dcc;                   // While going to the right, deaccelerate
     if (hsp&lt;0) hsp+=dcc;                   // While going to the left, deaccelerate

     if (hsp&gt;0 &amp;&amp; hsp&lt;dcc) hsp=0;           // If the speed is lower than deacceleration, set to 0.
     if (hsp&lt;0 &amp;&amp; hsp&gt;-dcc) hsp=0;
     
     if action == 15 &amp;&amp; abs (hsp) &lt; 0.3
        action = 0;     
   }
   

   // Check for collisions on the sides. If those are true, set the speed to 0.
   if (scrCollideSensorRight(obstacle_layer | high_layer | low_layer,MaskExtraLarge) &amp;&amp; hsp&gt;0) hsp=0;
   if (scrCollideSensorLeft(obstacle_layer | high_layer | low_layer,MaskExtraLarge) &amp;&amp; hsp&lt;0) hsp=0;
       
   // Now do vertical Movement.
   if (!ground)
   {
     // If we aren't on the ground and we are falling and the bottom sensor is colliding, land
     if (vsp&gt;=0 &amp;&amp; scrCollideSensorBottom(obstacle_layer | high_layer | low_layer,MaskLarge))
     {
        ground=1;
        vsp=0;
        if (action==1) action=0;       // If we were jumping, deactivate jump
        //audio_play_sound (sndLand, 10, false);
     }
   } else {
     // Otherwise, if we are on the ground and the bottom sensor isn't colliding, fall.
     if (!scrCollideSensorBottom(obstacle_layer | high_layer | low_layer,MaskLarge))    
     {
         ground=0;
     }
   }
   
   if (!ground)
   {
     // Apply forces if we are falling
     if action != 15 vsp+=vfr;  else vsp = 0; 
   }

   // Jump! (I add to this to allow Sonic to jump only during certain actions)
   if action=0 or action=3
   {
   if (KEY_A &amp;&amp; ground)
   {
   
        audio_play_sound (sndJump, 10, false);
        audio_play_sound (sndShadowJump, 10, false);
   
     ground=0;
     
     vsp=cosine*jmp-sine*hsp; // Calculate the speed
     hsp=cosine*hsp+sine*jmp;

     angle=0;     
     cosine=1;                // Values at angle 0
     sine=0;

     action=1;              // Set action to Jump
     
     delay=5                // Set key delay
   }
   }
   
   //If walking while in air, change to fall animation
   if action=0 &amp;&amp; ground=0
   {action=6}
   
   //Count down delay
   if delay&gt;0
   {delay-=1}
   
   //Blink after injury
   if ready&gt;0
   {
   ready-=1
   blink+=1
   }
   else
   {blink=0}
   
   if blink&gt;10
   {blink=0}
   
   // Ducking
   if KEY_DOWN &amp;&amp; action=0 &amp;&amp; ground &amp;&amp; hsp=0 //(Always remember to set required action in order to perform other action)
   {action=2}
   else
   if action=2 &amp;&amp; not KEY_DOWN
   {action=0}
   
   //Roll
   if KEY_DOWN &amp;&amp; abs(hsp)&gt;0.3 &amp;&amp; ground &amp;&amp; action=0
   {action=3 if spin == 0 audio_play_sound (sndSpindashRelease, 10, false)} //Play rolling sound here
   else
   if action=3 &amp;&amp; abs(hsp)&lt;=0.3
   {action=0}
   
   //Friction control while rolling
   if action=3
   {
   if angle=0 or angle=180 //If on flat ground, add friction
   {hsp-=xdir*0.1}
   else
   if xdir=1 &amp;&amp; angle&gt;0 &amp;&amp; angle&lt;180 //If going uphill going right, add friction
   {hsp-=xdir*0.1}
   else
   if xdir=-1 &amp;&amp; angle&lt;=360 &amp;&amp; angle&gt;180 //If going uphill going left, add friction
   {hsp-=xdir*0.1}
   else
   {hsp+=xdir*0.1} //If going downhill, reduce friction
   }
   
   //Set a speed limit while rolling
   if action=3
   {hspm=hspl} //Set max running speed to speed limit
   else
   {hspm=12} //Reset max running speed
   
   //If rolling in air, set to jump
   if action=3 &amp;&amp; ground=0
   {action=1}
   
   //Spin dash (must be ducking first): Edited for down + z to the x key alone whilst standing still
   //Adventure way (hold the attack button while still)
   if (KEY_BH &amp;&amp; !KEY_UP &amp;&amp; hsp == 0) &amp;&amp; ground //Start spindash
   {spin+=1 action=4  if KEY_B if !audio_is_playing (sndSpindashCharge) audio_play_sound (sndSpindashCharge, 10, false)} //Play spindash sound here
   
   if spin&gt;0 &amp;&amp; action=4 &amp;&amp; KEY_BH //Charge up spin dash
   {spin+=1 
   if !audio_is_playing (sndSpindashCharge) audio_play_sound (sndSpindashCharge, 10, false)} //Play spindash sound here as well
   
   if spin&gt;6 //Set spin limit
   {spin=6}
   
   if spin&gt;0 &amp;&amp; action==4 &amp;&amp; not KEY_BH //Take off from spindah
   {hsp+=xdir*spin*4 spin=0 action=3 audio_play_sound (sndSpindashRelease, 10, false) audio_stop_sound (sndSpindashCharge);} //Play take off sound here
   //Classic way (hold down and press jump repeatedly)
   if KEY_A &amp;&amp; action == 2
   {
        action = 4.5;
        spin += 1;
        audio_play_sound (sndSpindashChargeClassic, 10, false);
   }
   if KEY_A &amp;&amp; action == 4.5
   {
        spin += 1;
        audio_play_sound (sndSpindashChargeClassic, 10, false);
   }
   if spin&gt;6
   {spin=6}
   
   if not KEY_DOWN &amp;&amp; action==4.5
   {hsp+=spin*xdir*3 spin=0 action=3 audio_play_sound (sndSpindashRelease, 10, false) audio_stop_sound (sndSpindashChargeClassic)}
   
   if (action!=4.5 &amp;&amp; action!=4)
   {spin=0}
   
   if action==4.5 or action==4
   {hsp=0}
   
   //Homing attack (check animations for drawing sprites)
   if action=1 or action=6 or action=7
   {
   if KEY_A &amp;&amp; delay=0
   {
   action=5
   audio_play_sound (sndHoming, 10, false);
   audio_play_sound (sndShadowAttack, 10, false); //Play homing sound below action=5
   
   if instance_number(objHomingParent)&gt;0 //Check if there are enemies first
   {
   if distance_to_object(objHomingParent)&lt;320 &amp;&amp; enemy.y&gt;=y //Locked on (enemy must be in-line or below Sonic, not above)
   {lock=1}
   else
   {vsp=0 hsp+=xdir*6 lock=0} //If not near an enemy, just go foward
   }
   else
   {vsp=0 hsp+=xdir*6 lock=0} //If there are no enemies, just go foward
   }
   }
   
   //Lock on to nearest enemy (Notice I switch from Damizean's hsp,vsp function to speed and direction then back)
   if instance_number(objHomingParent)&gt;0
   {
   if lock=1 &amp;&amp; distance_to_object(objHomingParent)&lt;400 //Go towards enemy
   {direction=point_direction(x,y,enemy.x,enemy.y) speed=12 hsp=0 vsp=0}
   else
   if lock=1 &amp;&amp; speed&gt;0 //Cancel lock (too far away from enemies)
   {lock=0 hsp=hspeed vsp=vspeed speed=0}
   }
   else
   if lock=1 &amp;&amp; speed&gt;0 //Cancel lock (If no enemies are present)
   {lock=0 hsp=hspeed vsp=vspeed speed=0}

   //If there is a wall between you and an enemy, stop homing attack (also applies to layers)
   if instance_number(objHomingParent)&gt;0
   {
   if collision_line(x,y,enemy.x,enemy.y,objWall,1,1) &amp;&amp; lock=1
   {vsp=0 hsp=0 lock=0 speed=0}
   else
   if collision_line(x,y,enemy.x,enemy.y,objHLayer,1,1) &amp;&amp; lock=1 &amp;&amp; layer=0
   {vsp=0 hsp=0 lock=0 speed=0}
   else
   if collision_line(x,y,enemy.x,enemy.y,objLLayer,1,1) &amp;&amp; lock=1 &amp;&amp; layer=1
   {vsp=0 hsp=0 lock=0 speed=0}
   }
   
   //Grind on rail
   if dead=0
   {
   if collision_circle(x,y+30,20,obj_rail,1,1) &amp;&amp; ground //Grind on rail
   {if action!=8 audio_play_sound (sndGrindStart, 10, false); action=8 hsp+=acc*2*xdir}
   else
   if action=8 //If at end of rail
   {action=0 audio_stop_sound (sndGrindRail)}
   }
   
   //Play sfx
   if action == 8 &amp;&amp; !audio_is_playing (sndGrindRail)
        audio_play_sound (sndGrindRail, 10, true);
   if action != 8 audio_stop_sound (sndGrindRail);
   
   if action=8 &amp;&amp; KEY_A //This had to be set here to make Sonic jump off rail but not land back on rail
   {action=1 vsp=jmp ground=0 audio_play_sound (sndJump, 10, false) audio_play_sound (sndShadowJump, 10, false)}
   
   //Lightdash
   if action=0 or action=1 or action=3 or action=5 or action=6 or action=7
   {
   if KEY_B &amp;&amp; distance_to_object(objRing)&lt;150
   {ldash=1}
   }
   
   if ldash=1 &amp;&amp; distance_to_object(objRing)&lt;150 //Start using lightdash
   {
   action=11
   ground=0
   hsp=0
   vsp=0
   //speed=20 //&lt;-Adjust speed here
   //direction=point_direction(x,y,nring.x,nring.y)
   move_towards_point (nring.x, nring.y, 20);
   }
   else
   if action=11 //If there are no rings nearby. Stop the lightdash
   {hsp=hspeed vsp=vspeed speed=0 ldash=0 action=0}//Remeber to end the "speed" function or the player will keep going
   
   //Skidding
   if ( action == 12 )
        {
            // first check the direction of the movement
            if ( hsp &gt; 0 )
            {
                // decelerate while pressing left
                if (KEY_LEFT)       hsp -= skid_decc;
                
                // finish skidding
                if ( hsp &lt; 0 || !KEY_LEFT || !ground ) action = 0;
            }
            else if ( hsp &lt; 0 ) {
                // decelerate while pressing left
                if (KEY_RIGHT)      hsp += skid_decc;
                
                // finish skidding
                if ( hsp &gt; 0 || !KEY_RIGHT || !ground ) action = 0;
            }
            if (hsp == 0) action = 0;
        }
        else {
            if ( action == 0 &amp;&amp; ground == true)
            {
                if ((hsp&lt;-5) &amp;&amp; KEY_RIGHT)
                {
                    action = 12;
                }
                if ((hsp&gt;5) &amp;&amp; KEY_LEFT)
                {
                    action = 12;
                }
            }
        }
        
   
   
   
   //If dead restart the room
   if dead=1 &amp;&amp; y&gt;view_yview[0]+view_hview[0]+300
   {room_restart()}
   
//Super transformation
if global.canGoSuper == true or global.canGoHyper == true
{
    if action == 5 &amp;&amp; KEY_A &amp;&amp; global.rings &gt;= 50
       instance_change (objSuperShadowTransform, true);
}

if action == animationDash &amp;&amp; ground
   action = 0;
   
//Chaos abilities

//Chaos spear (press the attack button while holding up or in the air)
if ((action == 0 &amp;&amp; KEY_UP) or action == 1 or action == 6) &amp;&amp; KEY_B &amp;&amp; chaos_energy &gt;= chaos_spear &amp;&amp; distance_to_object (objRing) &gt;= 400
{
    action = 14;
    enable = 0;
}
else
{
    if !KEY_BH spear_charge = 90;
}

if KEY_BH &amp;&amp; action == 14
{
    spear_charge -= 1;
}

if KEY_BH &amp;&amp; animations_frame &gt; 124
    animations_frame = 123;

if action == 14
{
    if !KEY_BH
    {
        if ground &amp;&amp; animations_frame == 126
        {
            if spear_charge &lt;= 0 &amp;&amp; !instance_exists (objSpearCharged)
            {
                instance_create (x, y, objSpearCharged);
                chaos_energy -= chaos_spear_charged;
            }
            else if !instance_exists (objSpearGround)
            {
                instance_create (x, y, objSpearGround);
                chaos_energy -= chaos_spear;
            }
        }
        else if !instance_exists (objSpearAir) &amp;&amp; animations_frame == 133
        {
            instance_create (x, y, objSpearAir);
            chaos_energy -= chaos_spear;
        }
    }
}

//Chaos control (press the special key when either on the ground or in midair - must be purchased first)
if KEY_C &amp;&amp; (action == 0 or action == 1 or action == 6) &amp;&amp; chaos_energy &gt;= chaos_control
{
    action = 15;
    chaos_energy -= chaos_control;
    
    if hsp &lt; 18 hsp /*+= ((xdir*5)+hsp)*/ = (18*xdir); else hsp += (xdir*2);
    vsp = 0;
}

//Chaos blast (hold the down key and press the special key when the energy meter is full and on the ground - must be purchased first)
if KEY_DOWN &amp;&amp; KEY_C &amp;&amp; ground &amp;&amp; chaos_energy &gt;= chaos_blast
{
    action = 16;
    enable = 0;
    
    hsp = 0;
    chaos_energy -= chaos_blast;
}
if animations_frame == 11 &amp;&amp; action == 16
{
    instance_create (view_xview[0], view_yview[0], objWhiteBlast);
}

//Boost Mode (NOT the boost, only activates if Sonic hits a high speed)
if (place_meeting (x, y, objDashPad) &amp;&amp; ground &amp;&amp; action == 0) or audio_is_playing (bgmSpeedup)
{
    mach = true;  
    machTimer = 0;
}

if ground &amp;&amp; action == 0 &amp;&amp; abs(hsp) &gt;= 5
{
    machTimer -= (global.rings+1);
}
else
{
    if machTimer &gt; 0
        machTimer = 20000;
}

if machTimer &lt;= 0
{
    mach = true;
}
else
{
    mach = false;
}

if mach
{
    imageTimer -= 1;
    
    if imageTimer &lt;= 0
    {
        imageTimer = 5;
        instance_create (x, y, objShadowAfterImage);
    }
    
    if ground &amp;&amp; abs(hsp) &lt; 5
    {
       mach = false;
       if (machTimer &lt;= 0) machTimer = 20000;
    }
}

//Gimmick properties. These are set in seperate scripts for easy reference.

scrWater();
scrGimmicks();

if chaos_energy &gt; 100 chaos_energy = 100;
if chaos_energy &lt; 0 chaos_energy = 0;

/*if (place_meeting (x, y, objTubeStart) or place_meeting (x, y, objTube)) &amp;&amp; action == 3 &amp;&amp; !enable
{
    action = 3;
    enable = 0;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objMerchant">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if keyboard_check_pressed (vk_space) &amp;&amp; enable == true
{
    instance_create (0, 0, objFade);
    alarm[5] = 40;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objTalkParent">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if !instance_exists (objSpace)
   instance_create (x-24, y-50, objSpace);
else
    with objSpace instance_destroy();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objPlayerStop">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if other.canstop == true
{
    enable = 0;
    hsp = 0;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objRainbow">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>audio_play_sound (sndShadowTrick, 10, false);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objCheckpoint">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.start_x = other.x;
global.start_y = other.y;


if other.sprite_index == sprCheckpoint
{
    audio_play_sound (sndCheckpoint, 10, false);
    with other sprite_index = sprCheckpointActive;
    instance_create (view_xview[0]+240, view_yview[0]+180, objCheckpointTime);
    global.millisecondsC = global.milliseconds;
    global.secondsC = global.seconds;
    global.minutesC = global.minutes;
    global.milC = global.mil;
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objHarmful">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if global.invincible == false
{ if global.superstate == 0 &amp;&amp; global.rings &gt; 0
{
if ready&lt;=0 &amp;&amp; enable=1
{
{
ready=200
action=9
angle = 0;
audio_play_sound (sndShadowHurt, 10, false)

if global.shield == 0 &amp;&amp; global.rings &gt; 0
{
    audio_play_sound (sndRingLose, 10, false)
    
    if global.rings &lt;= 32 scrLoseRings(global.rings,x,y,objLoseRing) else scrLoseRings(32,x,y,objLoseRing)
    
    global.rings = 0;
}
else
{
    if global.shield == 1 or global.shield == 2 or (global.shield == 3 &amp;&amp; global.shieldhits = 1)
        global.shield = 0
    else if global.shield == 3 &amp;&amp; global.shieldhits &gt; 1
         global.shieldhits -= 1;
}

ground=0
vsp=-5
enable=0
}
}
}
else if global.rings == 0 &amp;&amp; global.shield == 0
if ready&lt;=0 &amp;&amp; enable=1 //Player dies if there are no rings
{
/*ground = 0;
vsp = -5;
enable = 0;
action = 9.5;
audio_play_sound (sndSonicOugh, 10, false);*/
instance_change (objShadowHitDie, true);
}
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objEnemyParent">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if global.invincible == false 
{if global.superstate == 0 &amp;&amp; global.rings &gt; 0
{
if atk=0 &amp;&amp; ready&lt;=0 &amp;&amp; enable=1
{
{
ready=200
action=9
audio_play_sound (sndShadowHurt, 10, false)

if global.shield == 0 &amp;&amp; global.rings &gt; 0
{
    audio_play_sound (sndRingLose, 10, false)
    
    if global.rings &lt;= 32 scrLoseRings(global.rings,x,y,objLoseRing) else scrLoseRings(32,x,y,objLoseRing)
    
    global.rings = 0;
}
else
{
    if global.shield == 1 or global.shield == 2 or (global.shield == 3 &amp;&amp; global.shieldhits = 1)
        global.shield = 0
    else if global.shield == 3 &amp;&amp; global.shieldhits &gt; 1
         global.shieldhits -= 1;
}

ground=0
vsp=-5
enable=0
}
}
}
else if global.rings == 0 &amp;&amp; global.shield == 0
if atk=0 &amp;&amp; ready&lt;=0 &amp;&amp; enable=1 //Player dies if there are no rings
{
/*ground = 0;
vsp = -5;
enable = 0;
action = 9.5;
audio_play_sound (sndShadowHurt, 10, false);*/
instance_change (objShadowHitDie, true);}
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objChangeLayer">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Change layer depending on speed
if (hsp&gt;0 &amp;&amp; ground) layer=1;
if (hsp&lt;0 &amp;&amp; ground) layer=0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objLowLayer">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>layer=1;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objHighLayer">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>layer=0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="4" ename="objSolid2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/*move_contact_solid (direction, 12);
vspeed = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>global.shield = 0;
global.invincible = false;

canMove = false;
alarm[3] = 60;

instance_create (0, 0, objRingCounter);
instance_create (0, 0, objRings);
instance_create (0, 0, objLivesCounterShadow);
instance_create (0, 0, objLives);
instance_create (view_xview[0]+240, view_yview[0]+180, objStart);
instance_create (0, 0, objTimer);
instance_create (0, 0, objScore);
instance_create (0, 0, objBar);

if instance_exists (objHub)
    instance_create (0, 0, objLocation);

if( global.start_x == -1 &amp;&amp; global.start_y == -1) {
    global.start_x = x;
    global.start_y = y;
}

x = global.start_x;
y = global.start_y;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if y &gt; room_height
{
    instance_change (objShadowDie, true);
    hsp = 0;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Simple animation system.

    //==========================================================
    // Set new animation

    // -&gt; Standing animation
    if (hsp==0 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=0;
        animations_framemin=0;
        animations_framemax=5;
        animations_return=0;
        animations_speed=20;
        atk=0
        
        if !instance_exists (objTalkingText) &amp;&amp; !instance_exists (objTalkingText2) 
            enable = 1;
        else enable = false;
    }

     //-&gt; Walking animation
    if (abs(hsp)&gt;0 &amp;&amp; abs(hsp)&lt;3 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=1;
        animations_framemin=6;
        animations_framemax=13;
        animations_return=6;
        animations_speed=12+abs(hsp*2);
        atk=0
        
        //Play stepping sound
        if ground &amp;&amp; (animations_frame == 7 or animations_frame == 11) &amp;&amp; animations_timer == 0
            audio_play_sound (soundstep, 10, false);
    }
    
    // -&gt; Jog animation
    if (abs(hsp)&gt;=3 &amp;&amp; abs(hsp)&lt;6 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=2;
        animations_framemin=14;
        animations_framemax=21;
        animations_return=14;
        animations_speed=12+abs(hsp*2);
        atk=0
        
        //Play stepping sound
        if ground &amp;&amp; (animations_frame == 14 or animations_frame == 18) &amp;&amp; animations_timer == 0
            audio_play_sound (soundstep, 10, false);
    }
    
    // -&gt; Run animation
    if (abs(hsp)&gt;6 &amp;&amp; abs(hsp)&lt;9 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=3;
        animations_framemin=22;
        animations_framemax=33;
        animations_return=22;
        animations_speed=12+abs(hsp*2);
        atk=0
        
        //Play stepping sound
        if ground &amp;&amp; (animations_frame == 23 &amp;&amp; !audio_is_playing (sndShadowSkate))
            audio_play_sound (sndShadowSkate, 10, false);
        if ground &amp;&amp; (animations_frame == 29 &amp;&amp; !audio_is_playing (sndShadowSkate2))
            audio_play_sound (sndShadowSkate2, 10, false);
    }
    
    // -&gt; Sprint animation
    if (abs(hsp)&gt;=9 &amp;&amp; abs(hsp)&lt;14 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=4;
        animations_framemin=34;
        animations_framemax=47;
        animations_return=34;
        animations_speed=12+abs(hsp*2);
        atk=0
        
        //Play stepping sound
        if ground &amp;&amp; (animations_frame == 35 &amp;&amp; !audio_is_playing (sndShadowSkate))
            audio_play_sound (sndShadowSkate, 10, false);
        if ground &amp;&amp; (animations_frame == 43 &amp;&amp; !audio_is_playing (sndShadowSkate2))
            audio_play_sound (sndShadowSkate2, 10, false);
    }
    
    // -&gt; Dash animation
    if (abs(hsp)&gt;=14 &amp;&amp; ground &amp;&amp; action==0) {
        spriteset=sprShadowActions;
        animation=5;
        animations_framemin=48;
        animations_framemax=63;
        animations_return=48;
        animations_speed=12+abs(hsp);
        atk=0
        
        //Play stepping sound
        if ground &amp;&amp; (animations_frame == 49 &amp;&amp; !audio_is_playing (sndShadowSkate))
            audio_play_sound (sndShadowSkate, 10, false);
        if ground &amp;&amp; (animations_frame == 57 &amp;&amp; !audio_is_playing (sndShadowSkate2))
            audio_play_sound (sndShadowSkate2, 10, false);
    }

    // -&gt; Jump animation
    if (action==1 or action==tube_action) {
        spriteset=sprShadowActions;
        animation=6;
        animations_framemin=64;
        animations_framemax=67;
        animations_return=64;
        animations_speed=18+abs(hsp);
        atk=1
        
        if action==1{draw_sprite_ext(spr_circleshadow,0,x,y,1.4,1.4,0,c_white,0.5) instance_create(x,y,obj_circleshadow) enable=1} else enable=0
        
        //if tube enable = 0; else enable = 1;
    }
    
    // -&gt; Duck animation
    if (action==2) {
        spriteset=sprShadowActions;
        animation=7;
        animations_framemin=72;
        animations_framemax=75;
        animations_return=75;
        animations_speed=30;
        atk=0
    }
    
    // -&gt; Roll animation
    if (action==3) {
        spriteset=sprShadowActions;
        animation=8;
        animations_framemin=68;
        animations_framemax=71;
        animations_return=68;
        animations_speed=30;
        atk=1
        draw_sprite_ext(spr_circleshadow,0,x,y,1.4,1.4,0,c_white,0.5) instance_create(x,y,obj_circleshadow)
    }
    
    // -&gt; Spindash animation
    if (action==4 or action==4.5) {
        spriteset=sprShadowActions;
        animation=9;
        animations_framemin=76;
        animations_framemax=79;
        animations_return=76;
        animations_speed=30+abs(spin*4);
        atk=1
        hsp=0
        if action == 4 {draw_sprite_ext(spr_circleshadow,0,x,y,1.4,1.4,0,c_white,0.5) instance_create(x,y,obj_circleshadow)}
    }
    
    // -&gt; Homing attack animation
    if (action==5) {
        spriteset=sprShadowActions;
        animation=10;
        animations_framemin=80;
        animations_framemax=83;
        animations_return=80;
        animations_speed=30;
        atk=1
        
    if  vsp&lt;4 &amp;&amp; ground=0
        {draw_sprite_ext(spr_circleshadow,0,x,y,1.4,1.4,0,c_white,0.5) instance_create(x,y,obj_circleshadow)}
        
    if  ground &amp;&amp; lock=0
        {action=0}
    }
    
    // -&gt; Bounce up animation
    if (action==6 &amp;&amp; vsp&lt;0) {
        spriteset=sprShadowActions;
        animation=11;
        animations_framemin=84;
        animations_framemax=85;
        animations_return=84;
        animations_speed=30+abs(vsp*2);
        atk=0
        enable=1
    }

    // -&gt; Fall animation
    if (action==6 &amp;&amp; vsp&gt;=0) {
        spriteset=sprShadowActions;
        animation=12;
        animations_framemin=86;
        animations_framemax=89;
        animations_return=88;
        animations_speed=10+abs(vsp*2);
        atk=0
        enable=1
        
    if  ground
        {action=0}
    }

    // -&gt; Homing attack bounce animation
    if (action==7) {
        spriteset=sprShadowActions;
        animation=13;
        animations_framemin=90;
        animations_framemax=93;
        animations_return=93;
        animations_speed=10;
        atk=1
        draw_sprite_ext(spr_circleshadow,0,x,y,1.4,1.4,0,c_white,0.5)
        
    if  ground
        {action=0}
    }
    
    // -&gt; Grind animation
    if (action==8) {
        spriteset=sprShadowActions;
        animation=14;
        animations_framemin=94;
        animations_framemax=95;
        animations_return=94;
        animations_speed=30+abs(hsp*2);
        atk=0
        enable=1
                
    if  abs(vsp)&gt;0
        {action=0}
    }
    
    // -&gt; Injury animation
    if (action==9) {
        spriteset=sprShadowActions;
        animation=15;
        animations_framemin=96;
        animations_framemax=100;
        animations_return=100;
        animations_speed=30;
        atk=0
        hsp=-xdir*2
        speed=0
                
    if  ground
        {action=0 enable=1}
    }

    //Injury animation (just before death)
    if (action==9.5) {
        spriteset=sprShadowActions;
        animation=15;
        animations_framemin=93;
        animations_framemax=95;
        animations_return=95;
        animations_speed=30;
        atk=0
        hsp=-xdir*2
        speed=0
                
    if  ground
        {instance_change (objSonicHitDie, true);}}
    
    // -&gt; Dead animation (up)
    if (action==10 &amp;&amp; vspeed&lt;=0) {
        spriteset=sprShadowActions;
        animation=16;
        animations_framemin=96;
        animations_framemax=96;
        animations_return=96;
        animations_speed=30;
        atk=0
        hsp=0
        enable=0
        depth=-100 
       }
       
    // -&gt; Dead animation (down)
    if (action==10 &amp;&amp; vspeed&gt;0) {
        spriteset=sprShadowActions;
        animation=17;
        animations_framemin=97;
        animations_framemax=100;
        animations_return=100;
        animations_speed=30;
        atk=0
        hsp=0
        enable=0
        depth=-100  
       }
       
    // -&gt; Light dash
    if (action==11) {
        spriteset=sprShadowActions;
        animation=18;
        animations_framemin=80;
        animations_framemax=83;
        animations_return=80;
        animations_speed=30;
        atk=1
       }
       
    // -&gt; Skidding animation
    if (action==12) {
        spriteset=sprShadowActions;
        animation=19;
        animations_framemin=101;
        animations_framemax=104;
        animations_return=101;
        animations_speed=20;
        atk=0
       }
       // -&gt; Dash ring animation
    if (action==animationDash) {
        spriteset=sprShadowActions;
        animation=20;
        animations_framemin=80;
        animations_framemax=83;
        animations_return=80;
        animations_speed=30;
        atk=1
        enable=1
    }
    // -&gt; Chaos spear animation
    if (action==14 &amp;&amp; ground) {
        spriteset=sprShadowActions;
        animation=21;
        animations_framemin=119;
        animations_framemax=130;
        animations_return=130;
        animations_speed=20;
        atk=0
        hsp=0
        vsp=0
        
        if animations_frame==130 action=0;
        
        if spear_charge &lt;= 30
        {
            var spearImage = 0;
            spearImage += 1;
            if spearImage &gt; 4 spearImage = 0;
            
            draw_sprite_ext (sprSpearGround, spearImage, x, y, 1, 1, 0, c_white, 1);
        }
       }
       if (action==14 &amp;&amp; !ground) {
        spriteset=sprShadowActions;
        animation=21;
        animations_framemin=131;
        animations_framemax=136;
        animations_return=136;
        animations_speed=20;
        atk=0
        hsp=0
        vsp=0
        
        if animations_frame==136 action=6;
       }
    // -&gt; Chaos control animation
    if (action==15 &amp;&amp; ground) {
        spriteset=sprShadowActions;
        animation=22;
        animations_framemin=105;
        animations_framemax=111;
        animations_return=111;
        animations_speed=20;
        atk=1
        
        if animations_frame==111 action = 0;
       }
    if (action==15 &amp;&amp; !ground) {
        spriteset=sprShadowActions;
        animation=22;
        animations_framemin=112;
        animations_framemax=118;
        animations_return=118;
        animations_speed=20;
        atk=1
        
        if animations_frame==118 action = 6;
       }
    //Chaos blast animation
    if (action==16) {
        spriteset=sprShadowActions2;
        animation=23;
        animations_framemin=0;
        animations_framemax=24;
        animations_return=24;
        animations_speed=20;
        atk=1
        hsp=0
        vsp=0
        
        if animations_frame==24 action = 0;
       }
       
    //Skydive animation
    if (action == 18) {
    spriteset=sprShadowActions;
    animation = 23;
    animations_framemin = 84;
    animations_framemax = 85;
    animations_return = 84;
    animations_speed = 20;
    atk = 0;
    enable = 1;
    }
    //Trick Animation
    if (action == animationTrick){
    spriteset=sprShadowActions;
    animation = 24;
    animations_framemin = 137;
    animations_framemax = 144;
    animations_return = 144;
    animations_speed = 10;
    atk = 1;
    enable = 0;
    
    if animations_frame == 144
        action = 6;
    }
    
    //Corkscrew Animations
    if action == 20 &amp;&amp; hsp &gt; 0
    {
        animation = 25;
        animations_framemin = 119;
        animations_framemax = 124;
        animations_return = 124;
        animations_speed = abs(hsp*4);
        atk = 0;
        enable = 1;
    }
    if action == 21 &amp;&amp; hsp &gt; 0
    {
        animation = 26;
        animations_framemin = 125;
        animations_framemax = 129;
        animations_return = 129;
        animations_speed = abs(hsp*4);
        atk = 0;
        enable = 1;
    }
    if action == 20 &amp;&amp; hsp &lt; 0
    {
        animation = 27;
        animations_framemin = 138;
        animations_framemax = 140;
        animations_return = 140;
        animations_speed = abs(hsp*4);
        atk = 0;
        enable = 1;
    }
    if action == 21 &amp;&amp; hsp &lt; 0
    {
        animation = 28;
        animations_framemin = 130;
        animations_framemax = 136;
        animations_return = 136;
        animations_speed = abs(hsp*4);
        atk = 0;
        enable = 1;
    }




    //==========================================================
    // Core of the animation system

    // If animation changed, change to the new parameters...
    if (animation!=animations_old) {
        animations_frame=animations_framemin;
        animations_timer=0;
        animations_old=animation;
    }

    // Add to the timer
    animations_timer+=animations_speed

    if (animations_timer&gt;=100)  // Check if we are ready to change of frame
    {    
        animations_timer=0;
        animations_frame+=1;
        
        if (animations_frame&gt;animations_framemax)
        {
            animations_frame=animations_return;
        }
    }

    // Get angle of the animation
    if (ground || action==1)
    {
        if action != 20 and action != 21
            animations_angle=angle;
    }
    
    // While not on the ground, rotate 
    if (!ground &amp;&amp; animations_angle&lt;180 &amp;&amp; animations_angle!=0 &amp;&amp; action!=1)
    {
        animations_angle-=4;
        if (animations_angle&lt;0) animations_angle=0;
    }
    
    if (!ground &amp;&amp; animations_angle&gt;180 &amp;&amp; animations_angle!=0 &amp;&amp; action!=1)
    {
        animations_angle+=4;
        if (animations_angle&gt;=360) animations_angle=0;
    }
    
    if (!ground &amp;&amp; animations_angle==180 &amp;&amp; action!=1)
    {
        animations_angle+=4*xdir;
    }
    // Draw the player
    
if global.shield = 1 &amp;&amp; global.invincible = false
{
    draw_sprite (sprShieldNormal, global.milliseconds div 35, x, y);
}
if global.shield = 2 &amp;&amp; global.invincible = false
{
    draw_sprite (sprShieldMagnetic, global.milliseconds div 35, x, y);
}
if global.shield = 3 &amp;&amp; global.invincible = false
{
    draw_sprite (sprShieldRed, global.milliseconds div 35, x, y);
}
if global.invincible = true
{
    draw_sprite (sprInvincible, global.milliseconds div 35, x, y);
    //draw_sprite (sprInvincible, global.milliseconds div 35, floor(x), floor(y));
}
    
if blink&lt;5
{draw_sprite_ext(    spriteset,  animations_frame,   x,y,    xdir,   1,   animations_angle,    c_white,1)};
//draw_sprite_ext (MaskMain, 0, x, y, 1, 1, animations_angle, c_white, 1);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="17">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>//instance_change (objKnuckles, true);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
